<div id="googleMap" style="width:100%;height:100%;"></div>
<script>
function myMap() {
    close = false
    var mapProp= {
        center:new google.maps.LatLng(<%= @coord_x[0] %>, <%= @coord_y[0] %>),
        zoom:4,
    };
    
    var map = new google.maps.Map(document.getElementById("googleMap"),mapProp);

    <% for i in Address.all.each %>
    
    var marker = new google.maps.Marker({
        
        position : new google.maps.LatLng(<%= @coord_x[i.id-1] %>, <%= @coord_y[i.id-1] %>),
        animation:google.maps.Animation.DROP,
        icon: 'assets/rsz_re-icon.png'

        
    });
     
// to close window, found on https://stackoverflow.com/questions/2223574/google-maps-auto-close-open-infowindows

     marker.window = new google.maps.InfoWindow({
               content: " <h1> <%= Address.find(i.id).street_number %></h1> <p> Customer name: <%= @customer_name[i.id-1] %> </p> <p> Number of battery: <%= @number_battery[i.id-1] %> </p> <p> Number of column: <%= @number_column[i.id-1]  %> </p> <p> Number Elevators: <%= @number_elevator[i.id-1]  %> </p> <p> Service Contact: <%= @service_name[i.id-1] %> </p>"
           });
           marker.addListener('click', function() {
                if( close ) {
                close.close();
                }
                close = this.window
               this.window.open(map, this);
           });


    marker.setMap(map);
    
// // Add multiple markers to map
//    var infoWindow = new google.maps.InfoWindow(), marker, i;
//    // Place each marker on the map
//    for( i = 0; i < markers.length; i++ ) {
//        var position = new google.maps.LatLng(markers[i][1], markers[i][2]);
//        bounds.extend(position);
//        marker = new google.maps.Marker({
//            position: position,
//            map: map,
//            title: markers[i][0]
//        });
//        // Add info window to marker
//        google.maps.event.addListener(marker, 'click', (function(marker, i) {
//            return function() {
//                infoWindow.setContent(infoWindowContent[i][0]);
//                infoWindow.open(map, marker);
//            }
//        })(marker, i));
//        // Center the map to fit all markers on the screen
//        map.fitBounds(bounds);
//    }


    <% end %>

}

</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDI2ADRtfrKDxEjxR1-fhMLmi0K-f6Xl-Q&callback=myMap"></script>

